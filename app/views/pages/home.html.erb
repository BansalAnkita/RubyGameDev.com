<% if signed_in? %>
  <% unless current_user.dismissed_welcome_message %>
    <div id="welcome_message" class="alert alert-success alert-dismissable">
      <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
      Welcome to RubyGameDev.com, the community-contributed, information hub which helps others to build games in Ruby! First time here? <%= link_to 'Read the blog post', '/blog/posts/1', class: 'alert-link' %> to learn more.
    </div>
    <%= form_for current_user, remote: true do |f| %>
      <%= f.hidden_field :dismissed_welcome_message, value: 1 %>
    <% end %>
  <% end %>
<% end %>

<div class="row">
  <div class="col-md-7">

    <div class="panel panel-default">
      <div class="panel-body">
        <%= link_to 'See More', discussions_path, class: 'btn btn-default pull-right' %>
        <h2>Discussions</h2>
        <%= render 'discussions/table' %>
      </div>
    </div>
    
    <div class="tutorials panel panel-default">
      <div class="panel-body">
        <%= link_to 'See More', tutorials_path, class: 'btn btn-default pull-right' %>
        <h2>Tutorials</h2>
        <table class="table">
          <tbody>
            <% @tutorials.each do |tutorial| %>
              <tr>
                <td class="score">
                  <%= link_to '#', data: {toggle: "modal", target: "#notImplementedModal"} do %>
                    <span class="up">&#x25B2;</span><br>
                  <% end %>
                  <%= tutorial.score %><br>
                  <%= link_to '#', data: {toggle: "modal", target: "#notImplementedModal"} do %>
                    <span class="down">&#x25BC;</span>
                  <% end %>
                </td>
                <td>
                  <% if tutorial.url.present? %>
                    <%= link_to tutorial.title, tutorial.url, target: '_blank' %>
                  <% else %>
                    <%= link_to tutorial.title, tutorial %>
                  <% end %>
                  <br><span class="text-muted">Submitted by <%= tutorial.user.username %> on <%= tutorial.created_at.strftime("%m/%d/%Y") %></span>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>

      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-body">
        <%= link_to 'See More', libraries_path, class: 'btn btn-default pull-right' %>
        <h2>Libraries</h2>
        <table class="table">
          <tbody>
            <% @library_categories.each do |library_category| %>
              <tr>
                <td><%= link_to library_category.title, library_category %></td>
                <td><%= library_category.libraries.count %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
    
  </div>

  <div class="col-md-5">

    <% if signed_in? %>
      <div class="panel panel-default">
        <div class="panel-body">
          <h2>Digest Email</h2>
          <% if current_user.digest_subscriber %>
            <p>You are signed up to receive <strong><%= current_user.digest_frequency %></strong> digest emails.</p>
          <% else %>
            <p>Sign up for an email digest so you never miss a thing!</p>
            <%= form_for current_user, html: {id:'digest_signup_form', class: 'form-inline'} do |f| %>
              <%= hidden_field_tag :redirect_to, root_path %>
              <%= f.hidden_field :digest_subscriber, value: 1 %>
              <p>
                <label class="radio-inline">
                  <input type="radio" name="user[digest_frequency]" value="daily" checked> Daily
                </label>
                <label class="radio-inline">
                  <input type="radio" name="user[digest_frequency]" value="weekly"> Weekly
                </label>
                <label class="radio-inline">
                  <input type="radio" name="user[digest_frequency]" value="monthly"> Monthly
                </label>
              </p>
              <div class="form-group">
                <input type="email" name="user[email]" class="form-control" placeholder="email@example.com">
              </div>
              <%= f.submit 'Subscribe', class: 'btn btn-primary' %>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>

    <div class="panel panel-default">
      <div class="panel-body">
        <%= link_to 'See More', questions_path, class: 'btn btn-default pull-right' %>
        <h2>Questions</h2>
        <p class="text-muted">Questions from GameDevSE tagged <strong>ruby</strong>.</p>
        <table class="table">
          <thead>
            <tr>
              <th>Answers</th>
              <th>Question</th>
            </tr>
          </thead>
          <tbody>
            <% @questions.each do |question| %>
              <tr>
                <td class="text-center"><%= question['answer_count'] %></td>
                <td><%= link_to question['title'], question['link'] %></p>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>

      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-body">
        <h2>Showcase</h2>
        <div class="media">
          <a class="pull-left" href="#">
            <%= image_tag 'joybox_asteroids_game.png', class: 'media-object', width: 150 %>
            <!-- <img class="media-object" src="http://placehold.it/150x150"> -->
          </a>
          <div class="media-body">
            <h4 class="media-heading">Joybox Asteroids</h4>
            Joybox combines the most popular and widely used 2D game engine for iOS, Cocos2D, 
            folds in the amazing Box2D physics engine, and then wraps them up into a clean Ruby API 
            that will make game development faster and more enjoyable for both beginners and experts alike.
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
